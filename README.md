# ComfyUI-HYPIR

[English](README_EN.md) | **ä¸­æ–‡**

---

### ðŸ“– é¡¹ç›®ç®€ä»‹

**ComfyUI-HYPIR** æ˜¯åŸºäºŽ [HYPIRé¡¹ç›®](https://github.com/XPixelGroup/HYPIR) å¼€å‘çš„ComfyUIè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œå®žçŽ°äº†é«˜è´¨é‡çš„å›¾åƒä¿®å¤åŠŸèƒ½ã€‚HYPIR (Harnessing Diffusion-Yielded Score Priors for Image Restoration) æ˜¯ä¸€ä¸ªåˆ©ç”¨æ‰©æ•£æ¨¡åž‹å¾—åˆ†å…ˆéªŒè¿›è¡Œå›¾åƒä¿®å¤çš„å…ˆè¿›æŠ€æœ¯ã€‚

æœ¬èŠ‚ç‚¹å°†HYPIRçš„å¼ºå¤§åŠŸèƒ½æ— ç¼é›†æˆåˆ°ComfyUIå·¥ä½œæµä¸­ï¼Œæ”¯æŒï¼š
- ðŸ”§ **æ™ºèƒ½å›¾åƒä¿®å¤** - åŽ»æ¨¡ç³Šã€åŽ»å™ªã€è¶…åˆ†è¾¨çŽ‡
- ðŸŽ›ï¸ **é¢„è®¾é…ç½®ç³»ç»Ÿ** - å¿«é€Ÿä¿®å¤ã€é«˜è´¨é‡ä¿®å¤ã€äººåƒä¼˜åŒ–ç­‰
- ðŸ“ **æ™ºèƒ½è·¯å¾„ç®¡ç†** - è‡ªåŠ¨æ£€æµ‹ComfyUIæ¨¡åž‹ç›®å½•ï¼Œä¸‹æ‹‰èœå•é€‰æ‹©
- âš¡ **1-8å€ä¸Šé‡‡æ ·** - çµæ´»çš„åˆ†è¾¨çŽ‡æå‡
- ðŸŽ¯ **LoRAè‡ªé€‚åº”** - è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®LoRAå‚æ•°

### âœ¨ ä¸»è¦ç‰¹æ€§

#### ðŸš€ **ç”¨æˆ·å‹å¥½**
- **é›¶é…ç½®å¯åŠ¨** - è‡ªåŠ¨åˆ›å»ºç›®å½•ç»“æž„å’Œé…ç½®æ–‡ä»¶
- **ä¸‹æ‹‰èœå•é€‰æ‹©** - æ— éœ€æ‰‹åŠ¨è¾“å…¥å¤æ‚è·¯å¾„
- **é¢„è®¾é…ç½®** - é’ˆå¯¹ä¸åŒåœºæ™¯çš„ä¼˜åŒ–å‚æ•°
- **å®žæ—¶åé¦ˆ** - è¯¦ç»†çš„å¤„ç†çŠ¶æ€å’Œå‚æ•°æ˜¾ç¤º

#### ðŸ”§ **æŠ€æœ¯å…ˆè¿›**
- **ComfyUIåŽŸç”Ÿé›†æˆ** - å®Œç¾Žèžå…¥ComfyUIå·¥ä½œæµ
- **folder_pathsç®¡ç†** - éµå¾ªComfyUIæ ‡å‡†è·¯å¾„ç®¡ç†
- **æ™ºèƒ½æ¨¡åž‹æ£€æµ‹** - è‡ªåŠ¨å‘çŽ°å’ŒéªŒè¯æ¨¡åž‹æ–‡ä»¶
- **å†…å­˜ä¼˜åŒ–** - å¤§å›¾åƒåˆ†å—å¤„ç†ï¼Œæ”¯æŒé«˜åˆ†è¾¨çŽ‡

#### ðŸŽ¨ **å¤„ç†æ•ˆæžœ**
- **å¤šåœºæ™¯é€‚é…** - è€ç…§ç‰‡ä¿®å¤ã€æ¨¡ç³Šå›¾åƒé”åŒ–ã€å™ªç‚¹åŽ»é™¤
- **äººåƒä¼˜åŒ–** - ä¸“é—¨çš„äººåƒä¿®å¤é¢„è®¾
- **é£Žæ™¯å¢žå¼º** - é’ˆå¯¹é£Žæ™¯ç…§ç‰‡çš„è‰²å½©å’Œç»†èŠ‚å¢žå¼º
- **çµæ´»ä¸Šé‡‡æ ·** - 1-8å€åˆ†è¾¨çŽ‡æå‡ï¼Œè´¨é‡ä¸Žé€Ÿåº¦å¹³è¡¡

### ðŸ“¦ å®‰è£…è¯´æ˜Ž

#### æ–¹æ³•ä¸€ï¼šGitå…‹éš†ï¼ˆæŽ¨èï¼‰
```bash
cd ComfyUI/custom_nodes/
git clone https://github.com/your-repo/ComfyUI-HYPIR.git
cd ComfyUI-HYPIR
pip install -r requirements.txt
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ä¸‹è½½
1. ä¸‹è½½é¡¹ç›®æ–‡ä»¶åˆ° `ComfyUI/custom_nodes/ComfyUI-HYPIR/`
2. å®‰è£…ä¾èµ–ï¼š`pip install -r requirements.txt`

### ðŸ“¥ æ¨¡åž‹ä¸‹è½½

#### å¿…éœ€æ¨¡åž‹æ–‡ä»¶

1. **HYPIRæƒé‡æ–‡ä»¶**
   ```bash
   # ä¸‹è½½åˆ° ComfyUI/models/HYPIR/
   wget https://huggingface.co/lxq007/HYPIR/resolve/main/HYPIR_sd2.pth
   ```
   æˆ–æ‰‹åŠ¨ä¸‹è½½ï¼š[HuggingFaceé“¾æŽ¥](https://huggingface.co/lxq007/HYPIR/tree/main)

2. **Stable Diffusion 2.0åŸºç¡€æ¨¡åž‹**
   ```bash
   # ä¸‹è½½åˆ° ComfyUI/models/diffusers/
   huggingface-cli download stabilityai/stable-diffusion-2-base --local-dir ComfyUI/models/diffusers/stable-diffusion-2-base
   ```

#### ðŸ—‚ï¸ æ ‡å‡†ç›®å½•ç»“æž„
```
ComfyUI/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ diffusers/
â”‚   â”‚   â””â”€â”€ stable-diffusion-2-base/     # SD2åŸºç¡€æ¨¡åž‹
â”‚   â””â”€â”€ HYPIR/
â”‚       â””â”€â”€ HYPIR_sd2.pth               # HYPIRæƒé‡æ–‡ä»¶
â””â”€â”€ custom_nodes/
    â””â”€â”€ ComfyUI-HYPIR/                  # æœ¬é¡¹ç›®
```

### ðŸŽ¯ ä½¿ç”¨æ–¹æ³•

#### 1. **åŸºç¡€ä½¿ç”¨**
1. é‡å¯ComfyUI
2. åœ¨èŠ‚ç‚¹èœå•ä¸­æ‰¾åˆ° `Image Restoration/HYPIR` â†’ `HYPIR Image Restoration`
3. è¿žæŽ¥å›¾åƒè¾“å…¥
4. é€‰æ‹©æ¨¡åž‹ï¼ˆè‡ªåŠ¨æ£€æµ‹çš„ä¸‹æ‹‰èœå•ï¼‰
5. é€‰æ‹©é¢„è®¾é…ç½®æˆ–è‡ªå®šä¹‰å‚æ•°
6. è¿è¡Œå·¥ä½œæµ

#### 2. **é¢„è®¾é…ç½®è¯´æ˜Ž**
| é¢„è®¾åç§° | é€‚ç”¨åœºæ™¯ | å‚æ•°ç‰¹ç‚¹ | æŽ¨èç”¨é€” |
|----------|----------|----------|----------|
| **å¿«é€Ÿä¿®å¤** | è½»åº¦é—®é¢˜ | ä½Žå‚æ•°ï¼Œå¿«é€Ÿå¤„ç† | æ—¥å¸¸ç…§ç‰‡è½»å¾®ä¿®å¤ |
| **æ ‡å‡†å¢žå¼º** | é€šç”¨åœºæ™¯ | å¹³è¡¡æ•ˆæžœä¸Žé€Ÿåº¦ | å¤§å¤šæ•°ä¿®å¤ä»»åŠ¡ |
| **é«˜è´¨é‡ä¿®å¤** | ä¸¥é‡é—®é¢˜ | é«˜å‚æ•°ï¼Œè´¨é‡ä¼˜å…ˆ | é‡è¦ç…§ç‰‡ã€ä¸¥é‡æŸå |
| **äººåƒä¼˜åŒ–** | äººç‰©ç…§ç‰‡ | é’ˆå¯¹äººè„¸ä¼˜åŒ– | äººåƒã€è‚–åƒç…§ç‰‡ |
| **é£Žæ™¯å¢žå¼º** | é£Žæ™¯ç…§ç‰‡ | è‰²å½©å’Œç»†èŠ‚enhancement | è‡ªç„¶é£Žå…‰ã€å»ºç­‘ |
| **æœ€å¤§æ•ˆæžœ** | æžç«¯ä¿®å¤ | æœ€é«˜å‚æ•°è®¾ç½® | æŒ‘æˆ˜æ€§ä¿®å¤ä»»åŠ¡ |

#### 3. **å‚æ•°è°ƒä¼˜æŒ‡å—**
- **upscale_factor**: 1-8å€ï¼ŒæŽ¨è2-4å€å¹³è¡¡è´¨é‡ä¸Žæ€§èƒ½
- **model_t/coeff_t**: 150-300ï¼Œæ•°å€¼è¶Šé«˜æ•ˆæžœè¶Šå¼ºä½†é€Ÿåº¦è¶Šæ…¢
- **lora_rank**: é€šå¸¸è‡ªåŠ¨æ£€æµ‹ä¸º256ï¼Œæ— éœ€ä¿®æ”¹
- **prompt**: æè¿°æœŸæœ›æ•ˆæžœï¼Œå¦‚"high quality, sharp, detailed"

### ðŸš€ é«˜çº§åŠŸèƒ½

#### ðŸŽ¨ **é’ˆå¯¹æ€§ä¿®å¤ç­–ç•¥**
```
è€ç…§ç‰‡ä¿®å¤ï¼š
- é¢„è®¾ï¼šäººåƒä¼˜åŒ–
- æç¤ºè¯ï¼švintage photo restoration, enhanced colors
- ä¸Šé‡‡æ ·ï¼š2-3å€

ä¸¥é‡æ¨¡ç³Šï¼š
- é¢„è®¾ï¼šæœ€å¤§æ•ˆæžœ  
- æç¤ºè¯ï¼šextremely sharp, deblurred, enhanced clarity
- ä¸Šé‡‡æ ·ï¼š2-4å€

ä½Žåˆ†è¾¨çŽ‡å›¾åƒï¼š
- é¢„è®¾ï¼šé«˜è´¨é‡ä¿®å¤
- æç¤ºè¯ï¼šhigh resolution upscale, detailed
- ä¸Šé‡‡æ ·ï¼š4-8å€
```

#### âš¡ **æ€§èƒ½ä¼˜åŒ–**
- **GPUæŽ¨è**: NVIDIA RTX 4090/4080 (16GB+ VRAM)
- **æœ€å°è¦æ±‚**: GTX 1080Ti/RTX 3060 (8GB VRAM)
- **å¤§å›¾å¤„ç†**: è‡ªåŠ¨åˆ†å—ï¼Œæ”¯æŒ4K+åˆ†è¾¨çŽ‡
- **å†…å­˜ç®¡ç†**: æ™ºèƒ½ç¼“å­˜ï¼Œé¿å…é‡å¤åŠ è½½

### ðŸ”§ æ•…éšœæŽ’é™¤

#### å¸¸è§é—®é¢˜

**Q: æ¨¡åž‹åŠ è½½å¤±è´¥**
```
A: æ£€æŸ¥æ–‡ä»¶è·¯å¾„ï¼š
   - HYPIRæƒé‡: ComfyUI/models/HYPIR/HYPIR_sd2.pth
   - SD2æ¨¡åž‹: ComfyUI/models/diffusers/stable-diffusion-2-base/
```

**Q: å¤„ç†æ•ˆæžœä¸æ˜Žæ˜¾**
```
A: è°ƒæ•´ç­–ç•¥ï¼š
   - é€‰æ‹©åˆé€‚çš„é¢„è®¾é…ç½®
   - ä½¿ç”¨é’ˆå¯¹æ€§çš„æç¤ºè¯
   - æé«˜model_t/coeff_tæ•°å€¼
   - å¢žåŠ ä¸Šé‡‡æ ·å€æ•°
```

**Q: æ˜¾å­˜ä¸è¶³**
```
A: ä¼˜åŒ–è®¾ç½®ï¼š
   - é™ä½Žä¸Šé‡‡æ ·å€æ•°
   - ä½¿ç”¨"å¿«é€Ÿä¿®å¤"é¢„è®¾
   - å‡å°è¾“å…¥å›¾åƒå°ºå¯¸
   - å…³é—­å…¶ä»–å ç”¨æ˜¾å­˜çš„ç¨‹åº
```

### ðŸ“Š æ•ˆæžœå±•ç¤º

æœ¬èŠ‚ç‚¹åœ¨ä»¥ä¸‹åœºæ™¯è¡¨çŽ°ä¼˜å¼‚ï¼š
- âœ… **è€ç…§ç‰‡ä¿®å¤** - è¤ªè‰²ã€åˆ’ç—•ã€å™ªç‚¹åŽ»é™¤
- âœ… **æ¨¡ç³Šå›¾åƒ** - è¿åŠ¨æ¨¡ç³Šã€æ•£ç„¦æ¢å¤  
- âœ… **ä½Žåˆ†è¾¨çŽ‡** - å°å›¾åƒé«˜è´¨é‡æ”¾å¤§
- âœ… **å™ªç‚¹åŽ»é™¤** - é«˜ISOå™ªç‚¹æ¸…ç†
- âœ… **ç»†èŠ‚å¢žå¼º** - çº¹ç†å’Œè¾¹ç¼˜é”åŒ–

### ðŸ¤ è‡´è°¢

æœ¬é¡¹ç›®åŸºäºŽä»¥ä¸‹ä¼˜ç§€å¼€æºé¡¹ç›®ï¼š
- **[HYPIR](https://github.com/XPixelGroup/HYPIR)** - æ ¸å¿ƒå›¾åƒä¿®å¤ç®—æ³•
- **[ComfyUI](https://github.com/comfyanonymous/ComfyUI)** - å¼ºå¤§çš„AIå·¥ä½œæµå¹³å°
- **[Stable Diffusion](https://huggingface.co/stabilityai/stable-diffusion-2-base)** - åŸºç¡€æ‰©æ•£æ¨¡åž‹

ç‰¹åˆ«æ„Ÿè°¢HYPIRå›¢é˜Ÿçš„æ°å‡ºå·¥ä½œï¼š
> Xinqi Lin, Fanghua Yu, Jinfan Hu, Zhiyuan You, Wu Shi, Jimmy S. Ren, Jinjin Gu, Chao Dong
